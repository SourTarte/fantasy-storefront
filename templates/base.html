{% load static %}

{% url 'product_list' as product_list_url %}
{% url 'account_login' as login_url %}
{% url 'account_signup' as signup_url %}
{% url 'account_logout' as logout_url %}
{% load i18n %}
{% load account socialaccount %}

<!DOCTYPE html>
<html class="h-100" lang="en">

<head>
    <title>The Dragon's Hoard: For Blades and Beer</title>
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

    <!-- Google Fonts CSS -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;700&display=swap" rel="stylesheet">

    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style2.css' %}">

    {% block extraheaders %}
    
    {% endblock extraheaders %}

</head>

<body class="d-flex flex-column h-100">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-md py-3" data-bs-theme="dark">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{% url 'product_list' %}">
                <span>
                    <i class="fa-solid fa-dragon me-3"></i>The Dragon's Hoard
                </span>
            </a>

            <button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-5"><span class="visually-hidden">Toggle navigation</span>
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navcol-5">
                {% if user.is_authenticated %}
                <ul class="navbar-nav mt-4">
                    <li class="nav-item text-white">Lovely to see you, {{ user }}</li>
                    <li class="nav-item"><a class="btn btn-primary m-1 nav-link {% if request.path == signup_url %}active{% endif %}" role="button" aria-current="page" href="{% url 'view_cart' %}">My Horsecart</a></li>
                    <li class="nav-item"><a class="btn btn-primary m-1 nav-link" data-bs-toggle="modal" data-bs-target="#logoutModal">Logout</a></li>
                </ul>
                
                <!--<button type="button" class="btn btn-primary ms-4" data-bs-toggle="modal" data-bs-target="#cartModal">
                    My Horsecart
                </button>-->
                {% else %}
                <ul class="navbar-nav mt-4">
                    <li class="nav-item"><a class="btn btn-primary m-1 nav-link {% if request.path == signup_url %}active{% endif %}" role="button" aria-current="page" href="{% url 'account_signup' %}">Sign Up</a></li>
                    <li class="nav-item"><a class="btn btn-primary m-1 nav-link {% if request.path == login_url %}active{% endif %}" role="button" aria-current="page" href="{% url 'account_login' %}">Login</a></li>
                </ul>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Logout Modal -->
    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="logoutModalLabel">Log Out?</h1>
                
            </div>
            <div class="modal-body">
                Are you sure you want to sign out?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <form method="post" action="{% url 'account_logout' %}">
                    {% csrf_token %}
                    {% if redirect_field_value %}
                    <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                    {% endif %}
                    <button class="btn btn-primary right" type="submit">{% trans 'Sign Out' %}</button>
                </form>
            </div>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <!--
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="logoutModalLabel">Shopping Cart</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h3>This Feature is Still Under Development</h3>
                {% for item in cart_items %}
                <div class="product-item">
                    <p>{{ item.product.name }} ({{ item.quantity }})</p>
                    <p>Price: ${{ item.product.price }}</p>
                    <a href="{% url 'remove_from_cart' item.id %}">Remove</a>
                </div>
                {% empty %}
                <p>Your cart is empty.</p>
                {% endfor %}
                <p>Total Price: ${{ total_price }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="{% url 'product_list' %}">Continue Shopping</a>
            </div>
            </div>
        </div>
    </div>
    -->
    
    
    <!-- displaying Django messages -->
    <div class="container">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                {% for product in products %}
                <div class="alert {{ product.tags }} alert-dismissible fade show" id="msg" role="alert">
                    {{ product | safe }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <main class="flex-shrink-0 bg">

        {% block content %}
        <!-- Content Goes here -->
        {% endblock content %}

    </main>

    <!-- Footer -->
    <footer id="footer-container" class="text-center bg-dark">
        <div class="container text-white py-2">
            <h5>Come Visit Us!:</h5>
            <h6>The Dragon's Hoard, 5 Market Street, Baldur's Gate, Faerun</h6>
            <hr>
            <p class="text-muted mb-0">
                {% block copyright %}
                {% endblock copyright %}
                2025 Â© Dion McMillan
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    {% block extras %}
    {% endblock %}
</body>

</html>